<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/images/favicon.ico" />
        <title>#{msgs['default.page.title']} | #{msgs['admin.site.list.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('site:access')}

        <f:metadata>
            <f:viewParam name="filter" value="#{das.filter}"/>
        </f:metadata>

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-a/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layourWgt" >

                <pe:layoutPane id="north" position="north" closable="false" resizable="false" size="40"/>

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">

                    <table class="navigation-sidebar">
                        <thead>
                            <tr><th>Site Dashboard</th></tr>
                        </thead>
                        <tfoot><tr><td></td></tr></tfoot>
                        <tbody>
                            <tr>
                                <td class="active">Sites</td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Create New Site" action="access-create-site-page" process="@this" type="button" rendered="#{permissionUtil.hasPermission('site:create')}"/></td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">


                    <table class="page-container">
                        <thead>
                            <tr><th>Sites</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <p:remoteCommand autoRun="true" async="true" actionListener="#{das.retrieveSites()}" update=":form:lazy-group-1"/>

                                    <p:spacer width="100%" height="20px"/>
                                    
                                    <h:panelGroup id="lazy-group-1">

                                        <p:graphicImage name="images/ajax-loader.gif" rendered="#{!das.renderSites}" styleClass="ajax-lazy-loader"/>

                                        <p:dataTable id="sites-table"
                                                     widgetVar="sitesTable"
                                                     var="site"
                                                     emptyMessage="#{msgs['empty.datatable']}"
                                                     selection="#{das.selectedSites}"
                                                     value="#{das.siteModel}"
                                                     filteredValue="#{das.filtered}"
                                                     styleClass="type1-table"
                                                     lazy="true"
                                                     paginator="true"
                                                     rows="20"
                                                     rowsPerPageTemplate="20,50"
                                                     paginatorAlwaysVisible="false"
                                                     paginatorPosition="bottom"
                                                     rendered="#{das.renderSites}"> 

                                            <f:facet name="header">   
                                                <p:inputText id="globalFilter" styleClass="align-left" onkeyup="sitesTable.filter()" style="width:200px" />  
                                                <p:watermark for="globalFilter" value="Search"/>
                                            </f:facet> 

                                            <p:ajax event="rowSelectCheckbox"  
                                                    update=":form:details"/>  
                                            <p:ajax event="rowUnselectCheckbox"
                                                    update=":form:details"/>
                                            <p:ajax event="rowSelect"  
                                                    update=":form:details"/>  
                                            <p:ajax event="rowUnselect"
                                                    update=":form:details"/>

                                            <p:column selectionMode="multiple" style="width:18px" />

                                            <p:column headerText="Name"
                                                      filterBy="#{site.name}"
                                                      filterStyle="display:none"
                                                      sortBy="#{site.name}">
                                                #{site.name}
                                            </p:column>

                                            <p:column headerText="VAR"
                                                      filterBy="#{site.var.name}"
                                                      filterStyle="display:none"
                                                      sortBy="#{site.var.name}">
                                                #{site.var.name}
                                            </p:column>

                                            <p:column headerText="Client"
                                                      filterBy="#{site.client.name}"
                                                      filterStyle="display:none"
                                                      sortBy="#{site.client.name}">
                                                #{site.client.name}
                                            </p:column>

                                            <p:column headerText="Support"
                                                      filterBy="#{site.packageType}"
                                                      filterStyle="display:none"
                                                      sortBy="#{site.packageType}">
                                                #{site.packageType}
                                            </p:column>

                                            <p:column headerText="IP"
                                                      filterBy="#{site.dmsIp}"
                                                      filterStyle="display:none"
                                                      sortBy="#{site.dmsIp}">
                                                #{site.dmsIp}
                                            </p:column>

                                            <p:column headerText="Reporting">
                                                <p:graphicImage rendered="#{site.reportingEnabled}" value="#{pathUtil.s3Icon('black/chart_line_icon_16.png')}" title="Reporting enabled"/>
                                            </p:column>

                                        </p:dataTable>

                                    </h:panelGroup>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="300">


                    <p:panel id="details" styleClass="empty-panel">

                        <p:dataList value="#{das.selectedSites}" 
                                    var="detail"
                                    itemType="none"
                                    rendered="#{das.selectedLength eq 1}">

                            <table width="100%">
                                <tr>
                                    <td colspan="2">
                                        <H2>
                                            <p:inplace id="nameAIP" styleClass="inplace" editor="true" label="#{detail.name}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                                <p:ajax event="save" listener="#{das.saveName()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                                <p:inputText id="editName" value="#{detail.name}"/>
                                                <p:watermark value="Name" for="editName"/>
                                            </p:inplace> 
                                        </H2>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Relationship</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">VAR:</td>
                                    <td>#{detail.var.name}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Client:</td>
                                    <td>#{detail.client.name}</td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Contact</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Address:</td>
                                    <td>
                                        <p:inplace id="addressAIP" styleClass="inplace" editor="true" label="#{detail.address.buildCompleteAddress()}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{das.saveAddress()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>

                                            <p:inputText id="add-1" value="#{detail.address.lineTwo}"/>
                                            <p:watermark value="Street" for="add-1"/>

                                            <p:inputText id="add-2" value="#{detail.address.lineThree}"/>
                                            <p:watermark value="City" for="add-2"/>

                                            <p:inputText id="add-3" value="#{detail.address.lineFour}"/>
                                            <p:watermark value="State" for="add-3"/>

                                            <p:inputText id="add-4" value="#{detail.address.lineFive}"/>
                                            <p:watermark value="Zip Code" for="add-4"/>
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Details</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">DMS IP:</td>
                                    <td>#{detail.dms}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Firmware:</td>
                                    <td>#{detail.dms}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Support:</td>
                                    <td>
                                        <p:inplace id="packageTypeAIP" styleClass="inplace" editor="true" label="#{detail.packageType eq null ? 'None' : detail.packageType}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{das.savePackageType()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                            <p:selectOneMenu value="#{detail.packageType}" 
                                                             effect="fade"
                                                             style="width: 180px">  
                                                <f:selectItem itemLabel="-" itemValue="" />
                                                <f:selectItem itemLabel="Monitoring" itemValue="Monitoring" />  
                                                <f:selectItem itemLabel="Maintenance" itemValue="Maintenance" />  
                                                <f:selectItem itemLabel="Monitoring and Maintenance" itemValue="Monitoring and Maintenance" /> 
                                            </p:selectOneMenu>
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Response:</td>
                                    <td>
                                        <p:inplace id="packageResponseAIP" styleClass="inplace" editor="true" label="#{detail.responseHrs} Hrs" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{das.savePackageResponse()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                            <p:spinner value="#{detail.responseHrs}" min="0"/> 
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Reporting:</td>
                                    <td>
                                        <p:inplace id="reportingEnabledAIP" styleClass="inplace" editor="true" label="#{detail.reportingEnabled ? 'Enabled' : 'Disabled'}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{das.saveReportingEnabled()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                            <p:selectBooleanButton value="#{detail.reportingEnabled}" onLabel="Enabled" offLabel="Disabled" />
                                        </p:inplace>
                                    </td>
                                </tr>
                                <ui:fragment rendered="#{permissionUtil.hasPermission('site:delete')}">
                                    <tr class="detail-divider">
                                        <td>Delete</td>
                                        <td></td>
                                    </tr>
                                    <tr class="table-spacer">
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Password:</td>
                                        <td><p:password id="deletePassword"  styleClass="align-right"/></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td><p:commandButton id="delete-btn" 
                                                             action="#{das.deleteSites()}" 
                                                             value="Delete" 
                                                             styleClass="align-right"
                                                             process="@this,deletePassword" 
                                                             update=":form:sites-table :form:growl :form:details"
                                                             onclick="PF('blockui1').block();"
                                                             oncomplete="PF('blockui1').unblock(); sitesTable.filter();"/>

                                            <pe:blockUI target="delete-btn" widgetVar="blockui1">  
                                                <div class="windows8-18-b">
                                                    <div class="wBall" id="wBall_1">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_2">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_3">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_4">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_5">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                </div> 
                                            </pe:blockUI>

                                        </td>
                                    </tr>
                                </ui:fragment>
                            </table>

                        </p:dataList>

                    </p:panel>

                </pe:layoutPane>
                
                <pe:layoutPane id="south" position="south" closable="false" resizable="false" size="40"><ez:footer/></pe:layoutPane>

            </pe:layout>

        </h:form>

    </h:body>

</html>

