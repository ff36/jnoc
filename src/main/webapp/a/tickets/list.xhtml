<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/images/favicon.ico" />
        <title>#{msgs['default.page.title']} | #{msgs['admin.ticket.list.page.title']}</title>
    </h:head>

    <h:body>

        #{jsfSessionUser.currentUser.hasPagePermission('ticket:access')}

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-a/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" 
                       widgetVar="layoutWgt" >

                <pe:layoutPane id="north" 
                               position="north" 
                               closable="false" 
                               resizable="false" 
                               size="40"/>

                <pe:layoutPane id="west" 
                               position="west" 
                               resizeWhileDragging="true" size="220">

                    <table class="navigation-sidebar">
                        <thead>
                            <tr><th>Ticket Dashboard</th></tr>
                        </thead>
                        <tfoot><tr><td></td></tr></tfoot>
                        <tbody>
                            <tr>
                                <td class="active">Tickets</td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Create New Ticket" 
                                                   action="/a/tickets/create.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Ticket Analytics" 
                                                   action="/a/tickets/analytics.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                        </tbody>
                    </table>

                    <p:spacer width="100%" height="10px"/>

                    <table class="navigation-sidebar">
                        <thead>
                            <tr><th>Filters</th></tr>
                        </thead>
                        <tfoot><tr><td></td></tr></tfoot>
                        <tbody>
                            <tr>
                                <td><p:commandLink value="Unassigned" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Open" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Closed" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="My Open" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="My Closed" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <tr>
                                <td><p:commandLink value="Clear Filters" 
                                                   action="/a/tickets/list.xhtml?faces-redirect=true" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" 
                               position="center" 
                               resizeWhileDragging="true" 
                               styleClassHeader="layout-header">

                    <table class="page-container">
                        <thead>
                            <tr><th>Support Tickets</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <p:remoteCommand autoRun="true" 
                                                     async="true" 
                                                     actionListener="#{tickets.init()}" 
                                                     update=":form:lazy-update-class"/>

                                    <p:spacer width="100%" height="20px"/>

                                    <h:panelGroup id="lazy-update-class">

                                        <p:graphicImage name="images/ajax-loader.gif" 
                                                        rendered="#{!tickets.dataTable.render}" 
                                                        styleClass="ajax-lazy-loader"/>

                                        <ui:fragment rendered="#{tickets.dataTable.render}">

                                            <p:dataTable id="tickets-table"
                                                         widgetVar="ticketsTable"
                                                         var="ticket"
                                                         emptyMessage="#{msgs['empty.datatable']}"
                                                         selection="#{tickets.dataTable.selected}"
                                                         value="#{tickets.dataTable.model}"
                                                         filteredValue="#{tickets.dataTable.filtered}"
                                                         styleClass="type1-table"
                                                         lazy="true"
                                                         paginator="true"
                                                         rows="20"
                                                         rowsPerPageTemplate="20,50"
                                                         paginatorAlwaysVisible="false"
                                                         paginatorPosition="bottom"> 

                                                <f:facet name="header">   
                                                    <p:inputText id="globalFilter" 
                                                                 styleClass="align-left" 
                                                                 onkeyup="PF('ticketsTable').filter()" 
                                                                 style="width:200px" />  
                                                    <p:watermark for="globalFilter" 
                                                                 value="Search"/>

                                                </f:facet> 

                                                <p:ajax event="rowSelectCheckbox"/>  
                                                <p:ajax event="rowUnselectCheckbox"/>
                                                <p:ajax event="rowSelect"/>  
                                                <p:ajax event="rowUnselect"/>

                                                <p:column selectionMode="multiple" 
                                                          style="width:18px" />

                                                <p:column headerText="ID"
                                                          filterBy="#{ticket.id}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.id}">
                                                    DTX-#{ticket.id}
                                                </p:column>

                                                <p:column headerText="Status"
                                                          filterBy="#{ticket.status}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.status}">
                                                    #{ticket.status}
                                                </p:column>

                                                <p:column headerText="Title"
                                                          filterBy="#{ticket.title}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.title}">
                                                    
                                                    <p:commandLink id="edit-ticket" 
                                                                   value="#{ticket.title}" 
                                                                   action="#{navigator.navigate('EDIT_TICKET_WITH_PARAM', 'ticket=' + ticket.id)}" 
                                                                   type="button" 
                                                                   process="@this,edit-ticket" 
                                                                   disabled="#{!jsfSessionUser.currentUser.hasPermission('ticket:edit')}"/>
                                                </p:column>

                                                <p:column headerText="Requester"
                                                          filterBy="#{ticket.requester.contact.buildFullName()}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.requester.contact.buildFullName()}">
                                                    #{ticket.requester.contact.buildFullName()}
                                                </p:column>

                                                <p:column headerText="Assignee"
                                                          filterBy="#{ticket.assignee.contact.buildFullName()}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.assignee.contact.buildFullName()}">
                                                    #{ticket.assignee.contact.buildFullName()}
                                                </p:column>

                                                <p:column headerText="Created"
                                                          filterBy="#{ticket.getOpenTimeStamp()}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.getOpenTimeStamp()}">
                                                    #{ticket.getOpenTimeStamp()}                        
                                                </p:column>

                                                <p:column headerText="Topic"
                                                          filterBy="#{ticket.topic}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.topic}">
                                                    #{ticket.topic}
                                                </p:column>

                                                <p:column headerText="Severity"
                                                          filterBy="#{ticket.severity}"
                                                          filterStyle="display:none"
                                                          sortBy="#{ticket.severity}">
                                                    #{ticket.severity}
                                                </p:column>

                                            </p:dataTable>

                                        </ui:fragment>

                                    </h:panelGroup>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="south" 
                               position="south" 
                               closable="false" 
                               resizable="false" 
                               size="40">
                    <ez:footer/>
                </pe:layoutPane>

            </pe:layout>

        </h:form>

    </h:body>

</html>

