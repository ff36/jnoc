<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <h:outputStylesheet name="css/dc.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/images/favicon.ico" />
        <title>#{msgs['default.page.title']} | #{msgs['admin.dashboad.page.title']}</title>

        <style>
            .average-time {
                background: #3182bd;
                color: #ffffff;
                width: 100%;
                font-size: 26px;
                text-align: center;
                padding-top: 30px;
                padding-bottom: 30px;
                margin-top: 5px;
                margin-bottom: 20px
            }
            .dc-chart g.row text {fill: black;}
        </style>
    </h:head>

    <h:body>

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-a/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layoutWgt" >

                <pe:layoutPane id="north" position="north" closable="false" resizable="false" size="40"/>

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">

                    <table class="navigation-sidebar">
                        <thead>
                            <tr><th>Ticket Dashboard</th></tr>
                        </thead>
                        <tfoot><tr><td></td></tr></tfoot>
                        <tbody>
                            <tr>
                                <td><p:commandLink value="Tickets" 
                                                   action="#{navigator.navigate('LIST_TICKETS')}" 
                                                   process="@this" 
                                                   type="button"/></td>
                            </tr>
                            <ui:fragment rendered="#{jsfSessionUser.currentUser.hasPermission('ticket:create')}">
                                <tr>
                                    <td><p:commandLink value="Create New Ticket" 
                                                       action="/a/tickets/create.xhtml?faces-redirect=true" 
                                                       process="@this" 
                                                       type="button"/></td>
                                </tr>
                            </ui:fragment>
                            <tr>
                                <td class="active">Ticket Analytics</td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">

                    <table class="page-container">
                        <thead>
                            <tr><th>My Support Ticket Stats</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <table class="ticket-stats-table">
                                        <tr>
                                            <td>
                                                <h3>Open Tickets</h3>
                                                <h:outputText value="" styleClass="ticket-stats-title"/>
                                            </td>
                                            <td>
                                                <h3>Lifetime Tickets</h3>
                                                <h:outputText value="" styleClass="ticket-stats-title"/>
                                            </td>
                                            <td>
                                                <h3>Ave. Response Time</h3>
                                                <h:outputText value="" styleClass="ticket-stats-title"/>
                                            </td>
                                            <td>
                                                <h3>Ave. Resolution Time</h3>
                                                <h:outputText value="" styleClass="ticket-stats-title"/>
                                            </td>
                                            <td>
                                                <h3>Ranking</h3>
                                                <h:outputText value="" styleClass="ticket-stats-title"/>
                                            </td>
                                            <td>
                                                <h3>Feedback</h3>
                                            </td>

                                        </tr>
                                        <tr>
                                            <td>
                                                <h:outputText value="2" styleClass="ticket-stats-value"/>
                                            </td>
                                            <td>
                                                <h:outputText value="84" styleClass="ticket-stats-value"/>
                                            </td>
                                            <td>
                                                <h:outputText value="34" styleClass="ticket-stats-value"/><h:outputText value="mins" styleClass="ticket-stats-ranking-sub"/>
                                            </td>
                                            <td>
                                                <h:outputText value="248" styleClass="ticket-stats-value"/><h:outputText value="mins" styleClass="ticket-stats-ranking-sub"/>
                                            </td>
                                            <td>
                                                <h:outputText value="3" styleClass="ticket-stats-value"/><h:outputText value="/56" styleClass="ticket-stats-ranking-sub"/>
                                            </td>
                                            <td>
                                                <h:outputText value="78%" styleClass="ticket-stats-value"/><h:outputText value="+" styleClass="ticket-stats-ranking-sub"/>
                                            </td>
                                        </tr>
                                    </table>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <p:spacer width="100%" height="20px"/>

                    <table class="page-container">
                        <thead>
                            <tr>
                                <th>

                                    <div class="dc-data-count">
                                        Support Ticket Stats | <span class="filter-count"></span> selected out of <span class="total-count"></span> records
                                    </div>

                                    <p:commandButton id="reset-button" 
                                                     styleClass="header-button white-button"
                                                     value="Reset"
                                                     process="@this"
                                                     onclick="dc.filterAll();
                                                             dc.renderAll();"/> 
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <p:remoteCommand autoRun="true" 
                                                     async="true" 
                                                     actionListener="#{ticketAnalytics.init()}" 
                                                     update=":form:lazy-group-1 :form:json-data"
                                                     onsuccess="loadScript('/resources/js/ticket-analytics.js')"/>

                                    <script>
                                        // Load the dc.js dynamically to make its variables available
                                        function loadScript(url) {

                                            var script = document.createElement("script")
                                            script.type = "text/javascript";

                                            if (script.readyState) {  //IE
                                                script.onreadystatechange = function () {
                                                    if (script.readyState == "loaded" ||
                                                            script.readyState == "complete") {
                                                        script.onreadystatechange = null;
                                                        //callback();
                                                    }
                                                };
                                            } else {  //Others
                                                script.onload = function () {
                                                    //callback();
                                                };
                                            }

                                            script.src = url;
                                            document.getElementsByTagName("head")[0].appendChild(script);
                                        }
                                    </script>

                                    <h:panelGroup id="lazy-group-1">

                                        <p:graphicImage name="images/ajax-loader.gif" 
                                                        rendered="#{!ticketAnalytics.render}" 
                                                        styleClass="ajax-lazy-loader"/>

                                        <h:panelGroup rendered="#{ticketAnalytics.render}">

                                            <h:inputHidden id="json-data" value="#{ticketAnalytics.data}"/>

                                            <h:outputScript library="js" name="d3.js"/>
                                            <h:outputScript library="js" name="dc.js"/>
                                            <h:outputScript library="js" name="crossfilter.js"/>
                                            <h:outputScript library="js" name="colorbrewer.js"/>

                                            <p:spacer width="100%" height="20px"/>

                                            <div class="row">
                                                <div id="range-chart">
                                                    <strong>Range Selector</strong>
                                                    <a class="reset" href="javascript:rangeChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <table width="100%">
                                                    <tr>
                                                        <td width="40%">
                                                            <strong>Average Response Time</strong>
                                                            <div class="average-time" id="average-response-time"></div>
                                                        </td>
                                                        <td width="40%">
                                                            <strong>Average Resolution Time</strong>
                                                            <div class="average-time" id="average-resolution-time"></div>
                                                        </td>
                                                        <td width="10%">
                                                            <strong>Opened Tickets</strong>
                                                            <div class="average-time" id="open-tickets"></div>
                                                        </td>
                                                        <td width="10%">
                                                            <strong>Closed Tickets</strong>
                                                            <div class="average-time" id="close-tickets"></div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>

                                            <div class="row">
                                                <div id="quarter-open-chart">
                                                    <strong>Quarters</strong>
                                                    <a class="reset" href="javascript:quarterOpenChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                                <div id="status-chart">
                                                    <strong>Status</strong>
                                                    <a class="reset" href="javascript:statusChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                                <div id="severity-chart">
                                                    <strong>Severity</strong>
                                                    <a class="reset" href="javascript:severityChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                                <div id="topic-chart">
                                                    <strong>Topic</strong>
                                                    <a class="reset" href="javascript:topicChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                                <div id="satisfaction-chart">
                                                    <strong>Satisfaction</strong>
                                                    <a class="reset" href="javascript:satisfactionChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                                <div id="day-of-week-open-chart">
                                                    <strong>Day of Week</strong>
                                                    <a class="reset" href="javascript:dayOfWeekOpenChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>

                                            </div>

                                            <div class="row">
                                                <div id="volume-chart">
                                                    <strong>Ticket Volume</strong>
                                                    <span class="reset" style="display: none;">range: <span class="filter"></span></span>
                                                    <a class="reset" href="javascript:volumeChart.filterAll();volumeChart.filterAll();dc.redrawAll();"
                                                       style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div id="monthly-volume-chart">
                                                </div>
                                            </div>

                                            <p:spacer width="100%" height="20px"/>

                                            <div class="row">
                                                <div id="tickets-summary-chart">
                                                    <strong>Tickets</strong>
                                                    <a class="reset" href="javascript:ticketSummaryChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                                                    <div class="clearfix"></div>
                                                </div>
                                            </div>

                                            <p:spacer width="100%" height="20px"/>

                                            <div class="clearfix"></div>


                                        </h:panelGroup>

                                    </h:panelGroup>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="280">

                    <table class="page-container">
                        <thead>
                            <tr><th>Companies</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <div class="row">
                                        <div id="company-chart">
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <p:spacer width="100%" height="20px"/>

                    <table class="page-container">
                        <thead>
                            <tr><th>DAS</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <div class="row">
                                        <div id="das-chart">
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <p:spacer width="100%" height="20px"/>

                    <table class="page-container">
                        <thead>
                            <tr><th>Assignee</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>

                                    <div class="row">
                                        <div id="assignee-chart">
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>

                                </td>
                            </tr>
                        </tbody>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="south" position="south" closable="false" resizable="false" size="40"><ez:footer/></pe:layoutPane>

            </pe:layout>

        </h:form>

    </h:body>

</html>

