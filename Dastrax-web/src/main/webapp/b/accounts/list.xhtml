<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth-b.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/graphics/favicon.ico" />
        <title>#{webBundle['default.page.title']} | #{webBundle['var.account.list.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('account:access')}

        <f:metadata>
            <f:viewParam name="filter" value="#{subjects.filter}"/>
            <f:viewAction action="#{subjects.init}" />
        </f:metadata>

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-b/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layoutWgt" >

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">     
                    <p:spacer width="100%" height="45"/>

                    <table class="side-menu">
                        <tr>
                            <td>
                                <p:commandButton id="new-account-btn" value="Create New Account" action="access-create-account-page" process="@this,:form:new-account-btn" rendered="#{permissionUtil.hasPermission('account:create')}"/>
                            </td>
                        </tr>
                    </table>

                    <table class="side-menu">
                        <tr>
                            <td>
                                <h3>Quick Filters</h3>
                            </td>
                        </tr>
                        <tr class="hover">
                            <td>
                                <p:commandLink value="All Accounts" action="#{subjects.tempFilterApply(0)}" process="@this" type="button"/>
                            </td>
                        </tr>
                        <tr class="hover">
                            <td>
                                <p:commandLink value="All Admins" action="#{subjects.tempFilterApply(10)}" process="@this" type="button"/>
                            </td>
                        </tr>
                        <tr class="hover">
                            <td>
                                <p:commandLink value="All Clients" action="#{subjects.tempFilterApply(11)}" process="@this" type="button"/>
                            </td>
                        </tr>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">
                    <p:spacer width="100%" height="45"/>

                    <table width="100%">
                        <tr>
                            <td><h2>Accounts</h2></td>
                            <td width="150px">

                            </td>
                        </tr>
                    </table>

                    <p:dataTable id="accounts-table"
                                 widgetVar="accountsTable"
                                 var="account"
                                 emptyMessage="#{webBundle['empty.datatable']}"
                                 selection="#{subjects.selectedSubjects}"
                                 value="#{subjects.subjectModel}"
                                 filteredValue="#{subjects.filtered}"
                                 styleClass="main-table"
                                 lazy="true"
                                 paginator="true"
                                 rows="20"
                                 rowsPerPageTemplate="20,50"
                                 paginatorAlwaysVisible="false"
                                 paginatorPosition="bottom"> 

                        <f:facet name="header">   
                            <p:inputText id="globalFilter" styleClass="align-left" onkeyup="accountsTable.filter()" style="width:200px" />  
                            <p:watermark for="globalFilter" value="Search"/>
                        </f:facet> 

                        <p:ajax event="rowSelectCheckbox"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselectCheckbox"
                                update=":form:details"/>
                        <p:ajax event="rowSelect"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselect"
                                update=":form:details"/>

                        <p:column selectionMode="multiple" style="width:18px" />

                        <p:column headerText="Name"
                                  filterBy="#{account.contact.buildFullName()}"
                                  filterStyle="display:none"
                                  sortBy="#{account.contact.buildFullName()}">
                            #{account.contact.buildFullName()}
                        </p:column>

                        <p:column headerText="Email"
                                  filterBy="#{account.email}"
                                  filterStyle="display:none"
                                  sortBy="#{account.email}">
                            #{account.email}
                        </p:column>

                        <p:column headerText="Company"
                                  filterBy="#{account.company.name}"
                                  filterStyle="display:none"
                                  sortBy="#{account.company.name}">
                            #{account.company.name}
                        </p:column>

                        <p:column headerText="Type"
                                  filterBy="#{account.metier.name}"
                                  filterStyle="display:none"
                                  sortBy="#{account.metier.name}">
                            #{account.metier.name}
                        </p:column>

                        <p:column id="acl">
                            <p:graphicImage value="#{pathUtil.s3Icon('black/padlock_closed_icon_16.png')}"
                                            rendered="#{account.account.locked}"/>  
                        </p:column>

                        <p:column id="verified">
                            <p:graphicImage value="#{pathUtil.s3Icon('black/attention_icon_16.png')}"
                                            rendered="#{!account.account.confirmed}"/>   
                        </p:column>

                    </p:dataTable>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="350">
                    <p:spacer width="100%" height="45"/>

                    <p:contextMenu for=":form:east" rendered="#{permissionUtil.hasPermission('account:edit')}">
                        <p:menuitem value="Add Permission" update="@(.perms-list)" icon="ui-icon-key" actionListener="#{subjects.addPermission()}" rendered="#{permissionUtil.hasPermission('permission:edit')}"/>
                        <p:menuitem value="Add Address" update="@(.add-list)" icon="ui-icon-contact" actionListener="#{subjects.addAddress()}"/>
                        <p:menuitem value="Add Telephone" update="@(.tel-list)" icon="ui-icon-contact" actionListener="#{subjects.addTelephone()}"/>
                    </p:contextMenu>

                    <p:panel id="details" styleClass="empty-panel">

                        <p:dataList value="#{subjects.selectedSubjects}" 
                                    var="detail"
                                    itemType="none"
                                    rendered="#{subjects.selectedLength eq 1}">

                            <table width="100%">
                                <tr>
                                    <td>
                                        <H2>
                                            <p:inplace id="nameAIP" styleClass="inplace" editor="true" label="#{detail.contact.buildFullName()}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                                <p:ajax event="save" listener="#{subjects.saveName()}" update=":form:accounts-table :form:growl" oncomplete="accountsTable.filter();"/>
                                                <p:inputText id="editFirstName" value="#{detail.contact.firstName}"/> 
                                                <p:inputText id="editLastName" value="#{detail.contact.lastName}"/>
                                                <p:watermark value="First Name" for="editFirstName"/>
                                                <p:watermark value="Last Name" for="editLastName"/>
                                            </p:inplace> 
                                        </H2>
                                    </td>
                                    <td>
                                        <p:graphicImage value="#{pathUtil.profileImage(detail.uid)}"
                                                        height="60px"
                                                        styleClass="details-image"/>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Security</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Metier:</td>
                                    <td>#{detail.metier.name}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">ACL:</td>
                                    <td>
                                        <p:inplace id="aclAIP" styleClass="inplace" editor="true" label="#{detail.account.locked ? 'Locked' : 'Unlocked'}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                            <p:ajax event="save" listener="#{subjects.saveACL()}" update=":form:accounts-table :form:growl" oncomplete="accountsTable.filter();"/>
                                            <p:selectBooleanButton value="#{detail.account.locked}" onLabel="Locked" offLabel="Unlocked" />
                                        </p:inplace> 
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Permissions</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Permission:</td>
                                    <td>
                                        <p:dataList id="perms-list" 
                                                    styleClass="clear-data-list perms-list" 
                                                    value="#{detail.permissions}"
                                                    var="perm"
                                                    itemType="none">
                                            <table width="100%">
                                                <tr>
                                                    <td>
                                                        <p:inplace id="permsAIP" styleClass="inplace" editor="true" label="#{perm ne null ? perm.name ne null ? perm.name : 'New Empty Permission' : 'No Permissions'}" disabled="#{!permissionUtil.hasPermission('permission:edit')}">  
                                                            <p:ajax event="save" listener="#{subjects.savePermissions()}" update=":form:accounts-table :form:growl perms-list" oncomplete="accountsTable.filter();"/>
                                                            <h:inputText value="#{perm.name}"/>
                                                        </p:inplace> 
                                                    </td>
                                                </tr>
                                            </table>
                                        </p:dataList>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Relationship</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Company:</td>
                                    <td>
                                        <p:inplace id="varCompanyAIP" styleClass="inplace" editor="true" label="#{detail.company.name}" rendered="#{detail.company.type eq 'VAR'}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                            <p:ajax event="save" listener="#{subjects.saveCompany()}" update=":form:accounts-table :form:growl" oncomplete="accountsTable.filter();"/>
                                            <p:selectOneMenu value="#{subjects.helper.selectedCompany}" 
                                                             effect="fade"
                                                             style="width: 180px">
                                                <f:selectItems value="#{subjects.helper.vars}" var="v" itemLabel="#{v.name}" itemValue="#{v.id}"/> 
                                            </p:selectOneMenu>
                                        </p:inplace>
                                        <p:inplace id="clientCompanyAIP" styleClass="inplace" editor="true" label="#{detail.company.name}" rendered="#{detail.company.type eq 'CLIENT'}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                            <p:ajax event="save" listener="#{subjects.saveCompany()}" update=":form:accounts-table :form:growl" oncomplete="accountsTable.filter();"/>
                                            <p:selectOneMenu value="#{subjects.helper.selectedCompany}" 
                                                             effect="fade"
                                                             style="width: 180px">
                                                <f:selectItems value="#{subjects.helper.clients}" var="v" itemLabel="#{v.name}" itemValue="#{v.id}"/> 
                                            </p:selectOneMenu>
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Contact</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Email:</td>
                                    <td>#{detail.email}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Address:</td>
                                    <td>
                                        <p:dataList id="address-list" 
                                                    styleClass="clear-data-list add-list" 
                                                    value="#{detail.contact.addresses}"
                                                    var="address"
                                                    itemType="none">
                                            <table width="100%">
                                                <tr>
                                                    <td>
                                                        <p:inplace id="addressAIP" styleClass="inplace" editor="true" label="#{address.buildCompleteAddress() ne '' ? address.buildCompleteAddress() : 'Not Available'}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                                            <p:ajax event="save" listener="#{subjects.saveAddress()}" update=":form:accounts-table :form:growl address-list" oncomplete="accountsTable.filter();"/>

                                                            <p:inputText id="add-1" value="#{address.lineTwo}"/>
                                                            <p:watermark value="Street" for="add-1"/>

                                                            <p:inputText id="add-2" value="#{address.lineThree}"/>
                                                            <p:watermark value="City" for="add-2"/>

                                                            <p:inputText id="add-3" value="#{address.lineFour}"/>
                                                            <p:watermark value="State" for="add-3"/>

                                                            <p:inputText id="add-4" value="#{address.lineFive}"/>
                                                            <p:watermark value="Zip Code" for="add-4"/>
                                                        </p:inplace> 
                                                    </td>
                                                </tr>
                                            </table>
                                        </p:dataList>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <p:dataList id="telephone-list" 
                                                    styleClass="clear-data-list tel-list" 
                                                    value="#{detail.contact.telephones}"
                                                    var="telephone"
                                                    itemType="none">
                                            <table width="100%">
                                                <tr>
                                                    <td class="field-label-2">#{telephone.type eq null ? 'Telephone' : telephone.type}:</td>
                                                    <td>
                                                        <p:inplace id="telephoneAIP" styleClass="inplace" editor="true" label="#{telephone.internationalFormat() eq null ? 'Not Available' : telephone.internationalFormat()}" disabled="#{!permissionUtil.hasPermission('account:edit')}">  
                                                            <p:ajax event="save" listener="#{subjects.saveTelephone()}" update=":form:accounts-table :form:growl telephone-list" oncomplete="accountsTable.filter();"/>
                                                            <ez:telephone type="#{telephone.type}"
                                                                          coutry="#{telephone.country}"                     
                                                                          number="#{telephone.localNumber}"/>  
                                                        </p:inplace> 
                                                    </td>
                                                </tr>
                                            </table>
                                        </p:dataList>
                                    </td>
                                </tr>
                                <ui:fragment rendered="#{permissionUtil.hasPermission('account:delete')}">
                                    <tr class="detail-divider">
                                        <td>Delete</td>
                                        <td></td>
                                    </tr>
                                    <tr class="table-spacer">
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Password:</td>
                                        <td><p:password id="deletePassword" value="#{subjects.principalPassword}" styleClass="align-right"/></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td><p:commandButton id="delete-btn" 
                                                             action="#{subjects.deleteAccounts()}" 
                                                             value="Delete" 
                                                             styleClass="align-right"
                                                             process="@this,deletePassword" 
                                                             update=":form:accounts-table :form:growl :form:details"
                                                             onclick="blockui1.block();"
                                                             oncomplete="blockui1.unblock(); accountsTable.filter();"/>

                                            <pe:blockUI target="delete-btn" widgetVar="blockui1">  
                                                <div class="windows8-18-b">
                                                    <div class="wBall" id="wBall_1">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_2">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_3">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_4">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_5">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                </div> 
                                            </pe:blockUI>

                                        </td>
                                    </tr>
                                </ui:fragment>
                            </table>

                        </p:dataList>

                    </p:panel>

                </pe:layoutPane>

            </pe:layout>

        </h:form>

        <!-- JIRA -->
        <script type="text/javascript" src="https://dastrax.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e/en_US-hgwqx7-1988229788/6132/31/1.4.0-m5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=5962a16e"></script>


    </h:body>

</html>

