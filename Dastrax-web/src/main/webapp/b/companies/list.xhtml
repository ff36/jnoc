<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth-b.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/graphics/favicon.ico" />
        <title>#{webBundle['default.page.title']} | #{webBundle['var.company.list.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('company:access')}

        <f:metadata>
            <f:viewParam name="filter" value="#{companies.filter}"/>
            <f:viewAction action="#{companies.init}" />
        </f:metadata>

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-b/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layoutWgt" >

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">
                    <p:spacer width="100%" height="45"/>

                    <table class="side-menu">
                        <tr>
                            <td>
                                <p:commandButton id="new-company-btn" value="Create New Client" action="access-create-company-page" process="@this,:form:new-company-btn" rendered="#{permissionUtil.hasPermission('account:create')}"/>
                            </td>
                        </tr>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">
                    <p:spacer width="100%" height="45"/>

                    <table width="100%">
                        <tr>
                            <td><h2>Clients</h2></td>
                            <td width="150px">

                            </td>
                        </tr>
                    </table>

                    <p:dataTable id="companies-table"
                                 widgetVar="companiesTable"
                                 var="company"
                                 emptyMessage="#{webBundle['empty.datatable']}"
                                 selection="#{companies.selectedCompanies}"
                                 value="#{companies.companyModel}"
                                 filteredValue="#{companies.filtered}"
                                 styleClass="main-table"
                                 lazy="true"
                                 paginator="true"
                                 rows="20"
                                 rowsPerPageTemplate="20,50"
                                 paginatorAlwaysVisible="false"
                                 paginatorPosition="bottom"> 

                        <f:facet name="header">   
                            <p:inputText id="globalFilter" styleClass="align-left" onkeyup="companiesTable.filter()" style="width:200px" />  
                            <p:watermark for="globalFilter" value="Search"/>
                        </f:facet> 

                        <p:ajax event="rowSelectCheckbox"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselectCheckbox"
                                update=":form:details"/>
                        <p:ajax event="rowSelect"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselect"
                                update=":form:details"/>

                        <p:column selectionMode="multiple" style="width:18px" />

                        <p:column headerText="Name"
                                  filterBy="#{company.name}"
                                  filterStyle="display:none"
                                  sortBy="#{company.name}">
                            #{company.name}
                        </p:column>

                        <p:column headerText="Type"
                                  filterBy="#{company.type}"
                                  filterStyle="display:none"
                                  sortBy="#{company.type}">
                            #{company.type}
                        </p:column>

                        <p:column headerText="# Members"
                                  filterBy="#{company.members.size()}"
                                  filterStyle="display:none">
                            #{company.members.size()}
                        </p:column>

                        <p:column headerText="# Sites">
                            <h:outputText value="#{company.clientSites.size()}" rendered="#{company.type eq 'CLIENT'}"/>
                            <h:outputText value="#{company.varSites.size()}" rendered="#{company.type eq 'VAR'}"/>
                        </p:column>

                    </p:dataTable>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="300">
                    <p:spacer width="100%" height="45"/>

                    <p:panel id="details" styleClass="empty-panel">

                        <p:dataList id="selected-company" 
                                    value="#{companies.selectedCompanies}" 
                                    var="detail"
                                    itemType="none"
                                    rendered="#{companies.selectedLength eq 1}">

                            <table width="100%">
                                <tr>
                                    <td>
                                        <H2>
                                            <p:inplace id="nameAIP" styleClass="inplace" editor="true" label="#{detail.name}" disabled="#{!permissionUtil.hasPermission('company:edit')}">  
                                                <p:ajax event="save" listener="#{companies.saveName()}" update=":form:companies-table :form:growl" oncomplete="companiesTable.filter();"/>
                                                <p:inputText id="editName" value="#{detail.name}"/> 
                                                <p:watermark value="Name" for="editName"/>
                                            </p:inplace> 
                                        </H2>
                                    </td>
                                    <td>
                                        <p:commandLink id="upload-btn" onclick="layoutWgt.open('south');" type="button" disabled="#{!permissionUtil.hasPermission('company:edit')}">
                                            <p:graphicImage id="logo" value="#{pathUtil.companyLogo3P(detail.id)}"
                                                            height="60px"
                                                            styleClass="details-image"/>
                                        </p:commandLink>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Security</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Type:</td>
                                    <td>#{detail.type}</td>
                                </tr>
                                <h:panelGroup rendered="#{detail.type eq 'VAR'}">
                                    <tr>
                                        <td class="field-label-2">Sub-domain:</td>
                                        <td>#{detail.subdomain}</td>
                                    </tr>
                                </h:panelGroup>
                                <tr class="detail-divider">
                                    <td>Relationship</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <h:panelGroup rendered="#{detail.type eq 'CLIENT'}">
                                    <tr>
                                        <td class="field-label-2"><p:commandLink value="Sites:" type="button" oncomplete="clientSitesDlg.show()" actionListener="#{companies.helper.filterSites()}" disabled="#{!permissionUtil.hasPermission('company:edit')}"/></td>
                                        <td>
                                            <p:dataList id="client-sites-list" 
                                                        styleClass="clear-data-list" 
                                                        value="#{detail.clientSites}"
                                                        var="clientSite"
                                                        itemType="none">
                                                <h:panelGrid columns="1">
                                                    <h:outputText value="#{clientSite.name}"/>
                                                </h:panelGrid>
                                            </p:dataList>
                                        </td>
                                    </tr>
                                </h:panelGroup>
                                <tr class="detail-divider">
                                    <td>Contact</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <p:dataList id="contact-list" 
                                            styleClass="clear-data-list" 
                                            value="#{detail.contacts}"
                                            var="contact"
                                            itemType="none">
                                    <tr>
                                        <td class="field-label-2">Name:</td>
                                        <td>
                                            <p:inplace id="nameAIP" styleClass="inplace" editor="true" label="#{contact.buildFullName()}" disabled="#{!permissionUtil.hasPermission('company:edit')}">  
                                                <p:ajax event="save" listener="#{companies.saveContacts()}" update=":form:companies-table :form:growl" oncomplete="companiesTable.filter();"/>
                                                <p:inputText id="editFirstName" value="#{contact.firstName}"/> 
                                                <p:inputText id="editLastName" value="#{contact.lastName}"/>
                                                <p:watermark value="First Name" for="editFirstName"/>
                                                <p:watermark value="Last Name" for="editLastName"/>
                                            </p:inplace> 
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="field-label-2">Email:</td>
                                        <td>
                                            <p:inplace id="emailAIP" styleClass="inplace" editor="true" label="#{contact.email eq null or contact.email eq '' ? 'Not Available' : contact.email}" disabled="#{!permissionUtil.hasPermission('company:edit')}">  
                                                <p:ajax event="save" listener="#{companies.saveContacts()}" update=":form:companies-table :form:growl" oncomplete="companiesTable.filter();"/>
                                                <p:inputText id="editEmail" value="#{contact.email}"/> 
                                                <p:watermark value="Email" for="editEmail"/>
                                            </p:inplace> 
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="field-label-2">Address:</td>
                                        <td>
                                            <p:dataList id="address-list" 
                                                        styleClass="clear-data-list" 
                                                        value="#{contact.addresses}"
                                                        var="address"
                                                        itemType="none">
                                                <p:inplace id="addressAIP" styleClass="inplace" editor="true" label="#{address.buildCompleteAddress()}" disabled="#{!permissionUtil.hasPermission('company:edit')}">  
                                                    <p:ajax event="save" listener="#{companies.saveContacts()}" update=":form:companies-table :form:growl" oncomplete="companiesTable.filter();"/>

                                                    <p:inputText id="add-1" value="#{address.lineTwo}"/>
                                                    <p:watermark value="Street" for="add-1"/>

                                                    <p:inputText id="add-2" value="#{address.lineThree}"/>
                                                    <p:watermark value="City" for="add-2"/>

                                                    <p:inputText id="add-3" value="#{address.lineFour}"/>
                                                    <p:watermark value="State" for="add-3"/>

                                                    <p:inputText id="add-4" value="#{address.lineFive}"/>
                                                    <p:watermark value="Zip Code" for="add-4"/>
                                                </p:inplace> 
                                            </p:dataList>
                                        </td>
                                    </tr>
                                    <p:dataList id="telephone-list" 
                                                styleClass="clear-data-list" 
                                                value="#{contact.telephones}"
                                                var="telephone"
                                                itemType="none">
                                        <tr>
                                            <td class="field-label-2">#{telephone.type eq null ? 'Telephone' : telephone.type}:</td>
                                            <td>

                                                <p:inplace id="telephoneAIP" styleClass="inplace" editor="true" label="#{telephone.internationalFormat() eq null ? 'Not Available' : telephone.internationalFormat()}" disabled="#{!permissionUtil.hasPermission('company:edit')}">  
                                                    <p:ajax event="save" listener="#{companies.saveContacts()}" update=":form:companies-table :form:growl" oncomplete="companiesTable.filter();"/>
                                                    <ez:telephone type="#{telephone.type}"
                                                                  coutry="#{telephone.country}"                     
                                                                  number="#{telephone.localNumber}"/>  
                                                </p:inplace> 

                                            </td>
                                        </tr>
                                    </p:dataList>
                                </p:dataList>
                                <ui:fragment rendered="#{permissionUtil.hasPermission('company:delete')}">
                                    <tr class="detail-divider">
                                        <td>Delete</td>
                                        <td></td>
                                    </tr>
                                    <tr class="table-spacer">
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Password:</td>
                                        <td><p:password id="deletePassword" value="#{companies.principalPassword}" styleClass="align-right"/></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td><p:commandButton id="delete-btn" 
                                                             action="#{companies.deleteCompanies()}" 
                                                             value="Delete" 
                                                             styleClass="align-right"
                                                             process="@this,deletePassword" 
                                                             update=":form:companies-table :form:growl :form:details"
                                                             onclick="blockui1.block();"
                                                             oncomplete="blockui1.unblock(); companiesTable.filter();"/>

                                            <pe:blockUI target="delete-btn" widgetVar="blockui1">  
                                                <div class="windows8-18-b">
                                                    <div class="wBall" id="wBall_1">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_2">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_3">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_4">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_5">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                </div> 
                                            </pe:blockUI>

                                        </td>
                                    </tr>
                                </ui:fragment>
                            </table>

                        </p:dataList>

                    </p:panel>

                </pe:layoutPane>

                <pe:layoutPane id="south" position="south" resizeWhileDragging="true" size="300" initHidden="true">

                    <table width="100%">
                        <tr>
                            <td><h2>Logo Manager</h2></td>
                            <td width="150px">
                                <p:commandLink styleClass="align-right" id="close-south-btn" onclick="layoutWgt.close('south');" type="button" value="Close"/>
                            </td>
                        </tr>
                    </table>

                </pe:layoutPane>

            </pe:layout>

            <p:dialog id="var-sites-dlg" header="VAR Sites" widgetVar="varSitesDlg" modal="true" dynamic="true">  
                <p:pickList id="var-sites" value="#{companies.helper.varSites}" var="site"  
                            itemValue="#{site}" itemLabel="#{site.id}" 
                            converter="siteCvt">  

                    <f:facet name="sourceCaption">Available</f:facet>  
                    <f:facet name="targetCaption">Selected</f:facet> 

                    <p:column style="width:75%;">  
                        #{site.name}  
                    </p:column>  

                </p:pickList>

                <p:commandButton id="save-var-sites-btn" 
                                 action="#{companies.saveVarSites()}" 
                                 value="Save" 
                                 styleClass="align-right"
                                 process="@this,var-sites" 
                                 update=":form:companies-table :form:growl :form:details"
                                 onclick="blockui2.block();"
                                 oncomplete="blockui2.unblock(); varSitesDlg.hide(); companiesTable.filter();"/>

                <pe:blockUI target="save-var-sites-btn" widgetVar="blockui2">  
                    <div class="windows8-18-b">
                        <div class="wBall" id="wBall_1">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_2">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_3">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_4">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_5">
                            <div class="wInnerBall">
                            </div>
                        </div>
                    </div> 
                </pe:blockUI>

            </p:dialog>

            <p:dialog id="client-sites-dlg" header="Client Sites" widgetVar="clientSitesDlg" modal="true" dynamic="true">  
                <p:pickList id="client-sites" value="#{companies.helper.clientSites}" var="site"  
                            itemValue="#{site}" itemLabel="#{site.id}" 
                            converter="siteCvt">  

                    <f:facet name="sourceCaption">Available</f:facet>  
                    <f:facet name="targetCaption">Selected</f:facet> 

                    <p:column style="width:75%;">  
                        #{site.name}  
                    </p:column>  

                </p:pickList>

                <p:commandButton id="save-client-sites-btn" 
                                 action="#{companies.saveClientSites()}" 
                                 value="Save" 
                                 styleClass="align-right"
                                 process="@this,client-sites" 
                                 update=":form:companies-table :form:growl :form:details"
                                 onclick="blockui3.block();"
                                 oncomplete="blockui3.unblock(); clientSitesDlg.hide(); companiesTable.filter();"/>

                <pe:blockUI target="save-client-sites-btn" widgetVar="blockui3">  
                    <div class="windows8-18-b">
                        <div class="wBall" id="wBall_1">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_2">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_3">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_4">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_5">
                            <div class="wInnerBall">
                            </div>
                        </div>
                    </div> 
                </pe:blockUI>

            </p:dialog>

            <p:dialog id="var-clients-dlg" header="Clients" widgetVar="varClientsDlg" modal="true" dynamic="true">  
                <p:pickList id="var-clients" value="#{companies.helper.clients}" var="client"  
                            itemValue="#{client}" itemLabel="#{client.id}" 
                            converter="companyCvt">  

                    <f:facet name="sourceCaption">Available</f:facet>  
                    <f:facet name="targetCaption">Selected</f:facet> 

                    <p:column style="width:75%;">  
                        #{client.name}  
                    </p:column>  

                </p:pickList>

                <p:commandButton id="save-var-clients-btn" 
                                 action="#{companies.saveVarClients()}" 
                                 value="Save" 
                                 styleClass="align-right"
                                 process="@this,var-clients" 
                                 update=":form:companies-table :form:growl :form:details"
                                 onclick="blockui4.block();"
                                 oncomplete="blockui4.unblock(); varClientsDlg.hide(); companiesTable.filter();"/>

                <pe:blockUI target="save-var-clients-btn" widgetVar="blockui4">  
                    <div class="windows8-18-b">
                        <div class="wBall" id="wBall_1">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_2">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_3">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_4">
                            <div class="wInnerBall">
                            </div>
                        </div>
                        <div class="wBall" id="wBall_5">
                            <div class="wInnerBall">
                            </div>
                        </div>
                    </div> 
                </pe:blockUI>

            </p:dialog>

        </h:form>

        <!-- JIRA -->
        <script type="text/javascript" src="https://dastrax.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e/en_US-hgwqx7-1988229788/6132/31/1.4.0-m5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=5962a16e"></script>


    </h:body>

</html>

