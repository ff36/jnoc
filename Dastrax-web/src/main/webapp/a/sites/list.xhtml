<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth-a.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/graphics/favicon.ico" />
        <title>#{webBundle['default.page.title']} | #{webBundle['admin.site.list.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('site:access')}

        <f:metadata>
            <f:viewParam name="filter" value="#{sites.filter}"/>
            <f:viewAction action="#{sites.init}" />
        </f:metadata>

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-a/>

            <pe:layout stateCookie="false" widgetVar="layourWgt" >

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">
                    <p:spacer width="100%" height="45"/>

                    <table class="side-menu">
                        <tr>
                            <td>
                                <p:commandButton id="new-site-btn" value="Create New Site" action="access-create-site-page" process="@this,:form:new-site-btn" rendered="#{permissionUtil.hasPermission('site:create')}"/>
                            </td>
                        </tr>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">
                    <p:spacer width="100%" height="45"/>

                    <table width="100%">
                        <tr>
                            <td><h2>Sites</h2></td>
                            <td width="150px">

                            </td>
                        </tr>
                    </table>

                    <p:dataTable id="sites-table"
                                 widgetVar="sitesTable"
                                 var="site"
                                 emptyMessage="#{webBundle['empty.datatable']}"
                                 selection="#{sites.selectedSites}"
                                 value="#{sites.siteModel}"
                                 filteredValue="#{sites.filtered}"
                                 styleClass="main-table"
                                 lazy="true"
                                 paginator="true"
                                 rows="20"
                                 rowsPerPageTemplate="20,50"
                                 paginatorAlwaysVisible="false"
                                 paginatorPosition="bottom"> 

                        <f:facet name="header">   
                            <p:inputText id="globalFilter" styleClass="align-left" onkeyup="sitesTable.filter()" style="width:200px" />  
                            <p:watermark for="globalFilter" value="Search"/>
                        </f:facet> 

                        <p:ajax event="rowSelectCheckbox"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselectCheckbox"
                                update=":form:details"/>
                        <p:ajax event="rowSelect"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselect"
                                update=":form:details"/>

                        <p:column selectionMode="multiple" style="width:18px" />

                        <p:column headerText="Name"
                                  filterBy="#{site.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.name}">
                            #{site.name}
                        </p:column>

                        <p:column headerText="VAR"
                                  filterBy="#{site.var.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.var.name}">
                            #{site.var.name}
                        </p:column>

                        <p:column headerText="Client"
                                  filterBy="#{site.client.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.client.name}">
                            #{site.client.name}
                        </p:column>

                        <p:column headerText="Support"
                                  filterBy="#{site.packageType}"
                                  filterStyle="display:none"
                                  sortBy="#{site.packageType}">
                            #{site.packageType}
                        </p:column>

                        <p:column headerText="IP"
                                  filterBy="#{site.dmsIP}"
                                  filterStyle="display:none"
                                  sortBy="#{site.dmsIP}">
                            #{site.dmsIP}
                        </p:column>

                    </p:dataTable>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="300">
                    <p:spacer width="100%" height="45"/>

                    <p:panel id="details" styleClass="empty-panel">

                        <p:dataList value="#{sites.selectedSites}" 
                                    var="detail"
                                    itemType="none"
                                    rendered="#{sites.selectedLength eq 1}">

                            <table width="100%">
                                <tr>
                                    <td>
                                        <H2>
                                            <p:inplace id="nameAIP" styleClass="inplace" editor="true" label="#{detail.name}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                                <p:ajax event="save" listener="#{sites.saveName()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                                <p:inputText id="editName" value="#{detail.name}"/>
                                                <p:watermark value="Name" for="editName"/>
                                            </p:inplace> 
                                        </H2>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Relationship</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">VAR:</td>
                                    <td>#{detail.var.name}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Client:</td>
                                    <td>#{detail.client.name}</td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Contact</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Address:</td>
                                    <td>
                                        <p:inplace id="addressAIP" styleClass="inplace" editor="true" label="#{detail.address.buildCompleteAddress()}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{sites.saveAddress()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>

                                            <p:inputText id="add-1" value="#{detail.address.lineTwo}"/>
                                            <p:watermark value="Street" for="add-1"/>

                                            <p:inputText id="add-2" value="#{detail.address.lineThree}"/>
                                            <p:watermark value="Town" for="add-2"/>

                                            <p:inputText id="add-3" value="#{detail.address.lineFour}"/>
                                            <p:watermark value="State" for="add-3"/>

                                            <p:inputText id="add-4" value="#{detail.address.lineFive}"/>
                                            <p:watermark value="Zip Code" for="add-4"/>
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Details</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">DMS IP:</td>
                                    <td>#{detail.dmsIP}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Firmware:</td>
                                    <td>#{detail.dmsType}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Support:</td>
                                    <td>
                                        <p:inplace id="packageTypeAIP" styleClass="inplace" editor="true" label="#{detail.packageType eq null ? 'None' : detail.packageType}" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{sites.savePackageType()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                            <p:selectOneMenu value="#{detail.packageType}" 
                                                             effect="fade"
                                                             style="width: 180px">  
                                                <f:selectItem itemLabel="-" itemValue="" />
                                                <f:selectItem itemLabel="Monitoring" itemValue="Monitoring" />  
                                                <f:selectItem itemLabel="Maintenance" itemValue="Maintenance" />  
                                                <f:selectItem itemLabel="Monitoring and Maintenance" itemValue="Monitoring and Maintenance" /> 
                                            </p:selectOneMenu>
                                        </p:inplace>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Response:</td>
                                    <td>
                                        <p:inplace id="packageResponseAIP" styleClass="inplace" editor="true" label="#{detail.responseHrs} Hrs" disabled="#{!permissionUtil.hasPermission('site:edit')}">  
                                            <p:ajax event="save" listener="#{sites.savePackageResponse()}" update=":form:sites-table :form:growl" oncomplete="sitesTable.filter();"/>
                                            <p:spinner value="#{detail.responseHrs}" min="0"/> 
                                        </p:inplace>
                                    </td>
                                </tr>
                                <ui:fragment rendered="#{permissionUtil.hasPermission('site:delete')}">
                                    <tr class="detail-divider">
                                        <td>Delete</td>
                                        <td></td>
                                    </tr>
                                    <tr class="table-spacer">
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Password:</td>
                                        <td><p:password id="deletePassword" value="#{sites.principalPassword}" styleClass="align-right"/></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td><p:commandButton id="delete-btn" 
                                                             action="#{sites.deleteSites()}" 
                                                             value="Delete" 
                                                             styleClass="align-right"
                                                             process="@this,deletePassword" 
                                                             update=":form:sites-table :form:growl :form:details"
                                                             onclick="blockui1.block();"
                                                             oncomplete="blockui1.unblock(); sitesTable.filter();"/>

                                            <pe:blockUI target="delete-btn" widgetVar="blockui1">  
                                                <div class="windows8-18-b">
                                                    <div class="wBall" id="wBall_1">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_2">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_3">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_4">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                    <div class="wBall" id="wBall_5">
                                                        <div class="wInnerBall">
                                                        </div>
                                                    </div>
                                                </div> 
                                            </pe:blockUI>

                                        </td>
                                    </tr>
                                </ui:fragment>
                            </table>

                        </p:dataList>

                    </p:panel>

                </pe:layoutPane>

            </pe:layout>

        </h:form>

        <!-- JIRA -->
        <script type="text/javascript" src="https://dastrax.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e/en_US-hgwqx7-1988229788/6132/31/1.4.0-m5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=5962a16e"></script>


    </h:body>

</html>

