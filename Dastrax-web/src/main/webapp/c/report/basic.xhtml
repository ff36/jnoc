<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth-c.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <h:outputScript library="js" name="jqplot.canvasAxisTickRenderer.min.js" />
        <h:outputScript library="js" name="jqplot.dateAxisRenderer.min.js" />
        <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/graphics/favicon.ico" />
        <title>#{webBundle['default.page.title']} | #{webBundle['client.report.basic.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('report-basic:access')}

        <h:form id="form">

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-c/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layourWgt" >

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="250">
                    <p:spacer width="100%" height="45"/>

                        <table class="side-menu">
                            <ui:fragment rendered="#{permissionUtil.hasPermission('monitor-basic:access')}">
                                <tr>
                                    <td>
                                        <h3>Monitor</h3>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                    </td>
                                </tr>
                                <tr class="hover">
                                    <td>
                                        <p:commandLink value="View basic monitor" action="access-basic-monitor-page" process="@this" type="button"/>
                                    </td>
                                </tr>
                                <tr class="hover">
                                    <td>
                                        <p:commandLink value="View advanced monitor" action="access-advanced-monitor-page" process="@this" type="button" rendered="#{permissionUtil.hasPermission('monitor-adv:access')}"/>
                                    </td>
                                </tr>
                            </ui:fragment>
                        </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">
                    <pe:layoutPane id="center-north" resizeWhileDragging="true" position="north" size="40%">  

                        <p:spacer width="100%" height="45"/>

                        <p:panel id="metrics" styleClass="empty-panel">

                            <h2><h:outputText value="Metrics"/></h2>

                            <p:dataTable id="metrics-table"
                                         widgetVar="metricsTable"
                                         var="metrics"
                                         emptyMessage="#{webBundle['empty.datatable']}"
                                         selection="#{basicReport.selectedReports}"
                                         value="#{basicReport.reportModel}"
                                         styleClass="main-table"> 

                                <p:ajax event="rowSelectCheckbox"
                                        listener="#{basicReport.selectEvent}"
                                        update=":form:charts"/>  
                                <p:ajax event="rowUnselectCheckbox"
                                        listener="#{basicReport.unselectEvent}"
                                        update=":form:charts"/>

                                <p:column selectionMode="multiple" style="width:18px" />

                                <p:column headerText="Site">  
                                    #{metrics.site.name}  
                                </p:column>

                                <p:column headerText="Report Metrics">  
                                    #{metrics.metrics}  
                                </p:column>

                            </p:dataTable>

                        </p:panel>

                    </pe:layoutPane>

                    <pe:layoutPane id="center-center" resizeWhileDragging="true"  position="center">  

                        <p:panel id="charts" styleClass="empty-panel">

                            <ui:fragment rendered="#{basicReport.selectedLength eq 0}">
                                <div class="select-report-metrics">
                                    <p:graphicImage value="#{pathUtil.s3Icon('white/arrow_top_icon_48.png')}"/>
                                    <p:spacer width="100%" height="5"/>
                                    <h:outputText value="Select metrics to view graph"/>
                                </div>
                            </ui:fragment>

                            <ui:fragment rendered="#{basicReport.selectedLength gt 0}">

                                <p:contextMenu for=":form:charts">
                                    <p:menuitem value="Refresh" actionListener="#{basicReport.buildChart()}" update=":form:charts" icon="ui-icon-refresh"/>
                                </p:contextMenu>

                                <p:dataList type="none" value="#{basicReport.selectedReports}" var="title">
                                    <h:outputText value="#{title.metrics} (%), " styleClass="report-title"/>
                                </p:dataList>

                                <p:spacer width="100%" height="10"/>

                                <table style="width: 100%;">
                                    <tr>
                                        <td>
                                            <p:lineChart id="line-chart" value="#{basicReport.reportChart}" zoom="true" animate="true"  
                                                         style="height:500px;width:100%" showMarkers="false" extender="chartExtender"
                                                         minX="#{basicReport.fromAsLong()}" maxX="#{basicReport.toAsLong()}"
                                                         legendPosition="s" legendRows="1"/> 
                                        </td>
                                        <td style="width: 200px; vertical-align: top;">

                                            <p:panel styleClass="ticket-options" header="Time Range" style="margin-top: 8px">

                                                <p:spacer width="100%" height="5"/>

                                                <h:panelGrid columns="2">

                                                    <h:outputText value="From:"/>
                                                    <p:calendar value="#{basicReport.from}" pattern="MM/dd/yyyy HH:mm" maxdate="#{basicReport.today()}">
                                                        <p:ajax event="dateSelect" listener="#{basicReport.selectEvent}" update="charts" />
                                                    </p:calendar>

                                                    <h:outputText value="To:"/>
                                                    <p:calendar value="#{basicReport.to}" pattern="MM/dd/yyyy HH:mm" mindate="#{basicReport.from}" maxdate="#{basicReport.today()}">
                                                        <p:ajax event="dateSelect" listener="#{basicReport.selectEvent}" update="charts"/>
                                                    </p:calendar>

                                                </h:panelGrid>

                                            </p:panel>
                                        </td>
                                    </tr>

                                </table>

                            </ui:fragment>

                            <script type="text/javascript">
                                function chartExtender() {
                                    this.cfg.axes = {
                                        xaxis: {
                                            renderer: $.jqplot.DateAxisRenderer,
                                            rendererOptions: {
                                                tickRenderer: $.jqplot.CanvasAxisTickRenderer
                                            },
                                            tickOptions: {
                                                fontSize: '10pt',
                                                fontFamily: 'Tahoma',
                                                angle: -40
                                            }
                                        },
                                        yaxis: {
                                            max: 100,
                                        }
                                    };
                                    this.cfg.axes.xaxis.ticks = this.cfg.categories;
                                }
                            </script>

                        </p:panel>

                    </pe:layoutPane>

                </pe:layoutPane>

            </pe:layout>

        </h:form>

        <!-- JIRA -->
        <script type="text/javascript" src="https://dastrax.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e/en_US-hgwqx7-1988229788/6132/31/1.4.0-m5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=5962a16e"></script>


    </h:body>

</html>

