<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:f="http://java.sun.com/jsf/core">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/auth-a.css"/>
        <h:outputStylesheet name="css/common.css"/>
        <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/graphics/favicon.ico" />
        <title>#{webBundle['default.page.title']} | #{webBundle['client.monitor.basic.page.title']}</title>
    </h:head>

    <h:body>

        #{permissionUtil.hasPagePermission('monitor-basic:access')}

        <f:metadata>
            <f:viewParam name="filter" value="#{basicMonitor.filter}"/>
            <f:viewAction action="#{basicMonitor.init}" />
        </f:metadata>

        <h:form id="form">
            
            <p:poll interval="3" update="@(.monitor-indicator-online)" /> 

            <pe:ajaxErrorHandler />

            <p:growl id="growl" 
                     redisplay="false"
                     showDetail="false" 
                     sticky="false" />

            <ez:navigation-c/>

            <pe:layout stateCookie="#{config.ProjectStage ne 'DEV'}" widgetVar="layourWgt" >

                <pe:layoutPane id="west" position="west" resizeWhileDragging="true" size="220">
                    <p:spacer width="100%" height="45"/>

                    <table class="side-menu">
                        <tr>
                            <td>
                                <p:commandButton id="adv-monitor-btn" value="Advanced Monitor" action="access-advanced-monitor-page" process="@this,:form:adv-monitor-btn" rendered="#{permissionUtil.hasPermission('monitor-adv:access')}"/>
                            </td>
                        </tr>
                    </table>

                </pe:layoutPane>

                <pe:layoutPane id="center" position="center" resizeWhileDragging="true">
                    <p:spacer width="100%" height="45"/>

                    <table width="100%">
                        <tr>
                            <td><h2>Sites</h2></td>
                            <td width="150px">

                            </td>
                        </tr>
                    </table>

                    <p:dataTable id="sites-table"
                                 widgetVar="sitesTable"
                                 var="site"
                                 emptyMessage="#{webBundle['empty.datatable']}"
                                 selection="#{basicMonitor.selectedSites}"
                                 value="#{basicMonitor.siteModel}"
                                 filteredValue="#{basicMonitor.filtered}"
                                 styleClass="main-table"
                                 lazy="true"
                                 paginator="true"
                                 rows="20"
                                 rowsPerPageTemplate="20,50"
                                 paginatorAlwaysVisible="false"
                                 paginatorPosition="bottom"> 

                        <f:facet name="header">   
                            <p:inputText id="globalFilter" styleClass="align-left" onkeyup="sitesTable.filter()" style="width:200px" />  
                            <p:watermark for="globalFilter" value="Search"/>
                        </f:facet> 

                        <p:ajax event="rowSelectCheckbox"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselectCheckbox"
                                update=":form:details"/>
                        <p:ajax event="rowSelect"  
                                update=":form:details"/>  
                        <p:ajax event="rowUnselect"
                                update=":form:details"/>

                        <p:column selectionMode="multiple" style="width:18px" />

                        <p:column headerText="Name"
                                  filterBy="#{site.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.name}">
                            #{site.name}
                        </p:column>

                        <p:column headerText="VAR"
                                  filterBy="#{site.var.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.var.name}">
                            #{site.var.name}
                        </p:column>

                        <p:column headerText="Client"
                                  filterBy="#{site.client.name}"
                                  filterStyle="display:none"
                                  sortBy="#{site.client.name}">
                            #{site.client.name}
                        </p:column>

                        <p:column headerText="IPv4"
                                  filterBy="#{site.dmsIP}"
                                  filterStyle="display:none"
                                  sortBy="#{site.dmsIP}">
                            #{site.dmsIP}
                        </p:column>
                        
                        <p:column  style="width: 110px">
                            <div class="#{basicMonitor.dmsStatus(site.id) eq 0 ? 'monitor-indicator-offline' : basicMonitor.dmsStatus(site.id) eq 1 ? 'monitor-indicator-online' : 'monitor-indicator-warning'}">
                                <p:graphicImage rendered="#{basicMonitor.dmsStatus(site.id) eq 0}" value="#{pathUtil.s3Icon('white/cancel_icon_16.png')}" styleClass="monitor-indicator-label"/>  
                                <p:graphicImage rendered="#{basicMonitor.dmsStatus(site.id) eq 1}" value="#{pathUtil.s3Icon('white/checkmark_icon_16.png')}" styleClass="monitor-indicator-label"/>
                                <p:graphicImage rendered="#{basicMonitor.dmsStatus(site.id) eq 2}" value="#{pathUtil.s3Icon('white/attention_icon_16.png')}" styleClass="monitor-indicator-label"/>
                                
                                <table width="100%">
                                    <tr>
                                        <td width="70%"><h:outputText value="DMS" styleClass="monitor-indicator-status"/></td>
                                        <td width="10%"><p:graphicImage value="#{pathUtil.s3Icon('black/network_icon_16.png')}" width="8px" styleClass="monitor-indicator-network-icon"/></td>
                                        <td width="20%"><h:outputText value="100%" styleClass="monitor-indicator-network"/></td>
                                    </tr>
                                    <tr>
                                        <td><p:clock pattern="HH:mm:ss" mode="client"/></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>        
                            </div>
                        </p:column>
                        
                        <p:column  style="width: 110px">
                            <div class="#{basicMonitor.deviceStatus(site.id) eq 0 ? 'monitor-indicator-offline' : basicMonitor.deviceStatus(site.id) eq 1 ? 'monitor-indicator-online' : 'monitor-indicator-warning'}">
                                <p:graphicImage rendered="#{basicMonitor.deviceStatus(site.id) eq 0}" value="#{pathUtil.s3Icon('white/cancel_icon_16.png')}" styleClass="monitor-indicator-label"/>  
                                <p:graphicImage rendered="#{basicMonitor.deviceStatus(site.id) eq 1}" value="#{pathUtil.s3Icon('white/checkmark_icon_16.png')}" styleClass="monitor-indicator-label"/>
                                <p:graphicImage rendered="#{basicMonitor.deviceStatus(site.id) eq 2}" value="#{pathUtil.s3Icon('white/attention_icon_16.png')}" styleClass="monitor-indicator-label"/>
                                
                                <table width="100%">
                                    <tr>
                                        <td width="70%"><h:outputText value="DAS" styleClass="monitor-indicator-status"/></td>
                                        <td width="10%"><p:graphicImage value="#{pathUtil.s3Icon('black/network_icon_16.png')}" width="8px" styleClass="monitor-indicator-network-icon"/></td>
                                        <td width="20%"><h:outputText value="100%" styleClass="monitor-indicator-network"/></td>
                                    </tr>
                                    <tr>
                                        <td><p:clock pattern="HH:mm:ss" mode="client"/></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>        
                            </div>
                        </p:column>

                    </p:dataTable>

                </pe:layoutPane>

                <pe:layoutPane id="east" position="east" resizeWhileDragging="true" size="300">
                    <p:spacer width="100%" height="45"/>

                    <p:panel id="details" styleClass="empty-panel">

                        <p:dataList value="#{basicMonitor.selectedSites}" 
                                    var="detail"
                                    itemType="none"
                                    rendered="#{basicMonitor.selectedLength eq 1}">

                            <table width="100%">
                                <tr>
                                    <td colspan="2">
                                        <H2>
                                            <h:outputText value="#{detail.name}"/>
                                        </H2>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Location</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <H2>
                                            <p:gmap center="39.0, -102.0" zoom="2" type="HYBRID" style="width:280px;height:200px" />
                                        </H2>
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Relationship</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">VAR:</td>
                                    <td>#{detail.var.name}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Client:</td>
                                    <td>#{detail.client.name}</td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Contact</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Address:</td>
                                    <td>
                                        <h:outputText value="#{detail.address.buildCompleteAddress()}"/>                                       
                                    </td>
                                </tr>
                                <tr class="detail-divider">
                                    <td>Details</td>
                                    <td></td>
                                </tr>
                                <tr class="table-spacer">
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">DMS IP:</td>
                                    <td>#{detail.dmsIP}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Firmware:</td>
                                    <td>#{detail.dmsType}</td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Support:</td>
                                    <td>
                                        <h:outputText value="#{detail.packageType eq null ? 'None' : detail.packageType}"/>                                    
                                    </td>
                                </tr>
                                <tr>
                                    <td class="field-label-2">Response:</td>
                                    <td>
                                        <h:outputText value="#{detail.responseHrs} Hrs"/>                                      
                                    </td>
                                </tr>                               
                            </table>

                        </p:dataList>

                    </p:panel>

                </pe:layoutPane>

            </pe:layout>

        </h:form>

        <!-- JIRA -->
        <script type="text/javascript" src="https://dastrax.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e/en_US-hgwqx7-1988229788/6132/31/1.4.0-m5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=5962a16e"></script>


    </h:body>

</html>

